(()=>{var f=new Int8Array,m,v,h,g,x,l=100,s=100,n,a,u,p,o,w={x:0,y:0,down:!1,delete:!1},i={now:0,last:0,tick:0},A="#8f00ff",S="#444444",k=!1,c;var T=(r,e,t)=>{let d=r/n,y=e/n;f[~~y*l+~~d]=t},E=(r,e,t,d)=>{o.beginPath(),o.moveTo(r,e),o.lineTo(t,d),o.stroke()},L=()=>{i.now=new Date().getTime();let r=i.now-i.then;i.then=i.now,i.tick+=r,k?w.down&&T(w.x,w.y,!w.delete):i.tick>=600&&(v(),f=new Int8Array(h.buffer,x(l,s),l*s),i.tick=0),o.fillStyle=A,o.strokeStyle=S,o.clearRect(0,0,window.innerWidth,window.innerHeight);for(let e=0;e<l;e++)E(e*n,0,e*n,window.innerHeight);for(let e=0;e<s;e++)E(0,e*n,window.innerWidth,e*n);for(let e=0;e<f.length;e++){let t=f[e],d=e%l*n,y=~~(e/l)*n;t&&o.fillRect(d,y,n,n)}};WebAssembly.instantiateStreaming(fetch("./public/lib.wasm"),{env:{consoleLog:console.log}}).then(({instance:r})=>{n=window.innerWidth>window.innerHeight?window.innerWidth/l:window.innerHeight/s,window.innerWidth<window.innerHeight?l=1+~~(window.innerWidth/n):s=1+~~(window.innerHeight/n),x=r.exports.acceptArray,g=r.exports.updateRules,h=r.exports.memory,v=r.exports.runGameAlgorithm,f=new Int8Array(h.buffer,x(l,s),l*s),c+=l*s*Int8Array.BYTES_PER_ELEMENT,c+=4*Int32Array.BYTES_PER_ELEMENT,m="l2=0 m3=0 =3=1";let e=new Int8Array(h.buffer,c,m.length);e.set(new TextEncoder().encode(m)),g(c,e.length),a=document.querySelector("#rules"),p=document.querySelector("#paused"),u=document.querySelector("input"),o=document.querySelector("#canvas").getContext("2d"),o.canvas.width=window.innerWidth,o.canvas.height=window.innerHeight,window.onscroll=t=>{},window.onkeydown=t=>{document.querySelector("#notes").classList.add("hidden"),t.key=="Shift"&&a.classList.toggle("hidden"),a.classList.contains("hidden")||u.focus(),t.key==" "&&(k=!0,p.classList.remove("hidden")),t.key=="x"&&(w.delete=!0)},window.onkeyup=t=>{t.key==" "&&(k=!1,p.classList.add("hidden")),t.key=="x"&&(w.delete=!1)},a.onkeydown=t=>{if(t.code!="Enter"&&t.key!="Escape")return;a.classList.add("hidden");let d=new Int8Array(h.buffer,c,u.value.length?u.value.length:14);d.set(new TextEncoder().encode(u.value||"l2=0 m3=0 =3=1")),g(d,d.length)},window.onmousedown=window.onmouseup=t=>{w.down=t.type=="mousedown"},window.onmousemove=t=>{w.x=t.clientX,w.y=t.clientY},i.now=new Date().getTime(),i.then=i.now-1/60,setInterval(L,60)});})();
